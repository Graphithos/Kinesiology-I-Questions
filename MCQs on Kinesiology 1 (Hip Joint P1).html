<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQs on Kinesiology 1 (Hip Joint P1) Quiz</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --primary-color: #3498db;
            --header-color: #2c3e50;
            --secondary-text: #7f8c8d;
            --progress-bg: #ecf0f1;
            --question-bg: #f8f9fa;
            --option-bg: #fff;
            --option-hover: #f1f8ff;
            --option-selected: #d1ecf1;
            --correct-bg: #d4edda;
            --correct-border: #28a745;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #dc3545;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --button-disabled: #bdc3c7;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #ecf0f1;
            --toggle-slider: white;
            --toggle-text: #7f8c8d;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --text-color: #e6e6e6;
            --border-color: #394867;
            --primary-color: #4cc9f0;
            --header-color: #e6e6e6;
            --secondary-text: #a9a9a9;
            --progress-bg: #394867;
            --question-bg: #1f4068;
            --option-bg: #16213e;
            --option-hover: #1f4068;
            --option-selected: #1f4068;
            --correct-bg: #2d5a2d;
            --correct-border: #4caf50;
            --incorrect-bg: #5a2d2d;
            --incorrect-border: #f44336;
            --button-bg: #4cc9f0;
            --button-hover: #3aa8d0;
            --button-disabled: #5d6d7e;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #394867;
            --toggle-slider: #4cc9f0;
            --toggle-text: #e6e6e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        h1 {
            color: var(--header-color);
            margin-bottom: 5px;
            font-size: 24px;
            transition: color 0.3s;
        }
        .author {
            color: var(--secondary-text);
            font-style: italic;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .description {
            color: var(--secondary-text);
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        .theme-toggle {
            position: absolute;
            top: 35px; /* Adjusted to align with author name */
            right: 0;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--toggle-text);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 60px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-slider);
            transition: .4s;
            border-radius: 34px;
            z-index: 1;
        }
        .slider-text {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .light-text, .dark-text {
            transition: opacity 0.3s;
        }
        .dark-mode .light-text {
            opacity: 0.5;
        }
        .light-text {
            opacity: 0.5;
        }
        .dark-mode .dark-text {
            opacity: 1;
        }
        .dark-text {
            opacity: 0.5;
        }
        input:checked + .slider:before {
            transform: translateX(52px);
        }
        .progress-container {
            background: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            height: 10px;
            transition: background-color 0.3s;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .question {
            background: var(--question-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .options {
            display: grid;
            grid-gap: 10px;
        }
        .option {
            padding: 12px 15px;
            background: var(--option-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: var(--option-hover);
            border-color: var(--primary-color);
        }
        .option.selected {
            background: var(--option-selected);
            border-color: var(--primary-color);
        }
        .option.correct {
            background: var(--correct-bg);
            border-color: var(--correct-border);
        }
        .option.incorrect {
            background: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .feedback {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .feedback.correct {
            background: var(--correct-bg);
            color: var(--text-color);
            border: 1px solid var(--correct-border);
            display: block;
        }
        .feedback.incorrect {
            background: var(--incorrect-bg);
            color: var(--text-color);
            border: 1px solid var(--incorrect-border);
            display: block;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--button-hover);
        }
        button:disabled {
            background: var(--button-disabled);
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .score {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--header-color);
        }
        .score-value {
            font-size: 48px;
            color: var(--primary-color);
            font-weight: bold;
        }
        .restart-btn {
            margin-top: 20px;
            background: var(--restart-bg);
        }
        .restart-btn:hover {
            background: var(--restart-hover);
        }
        .review-btn {
            margin-top: 20px;
            background: var(--review-bg);
        }
        .review-btn:hover {
            background: var(--review-hover);
        }
        .review-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--question-bg);
            border-radius: 8px;
            display: none;
        }
        .review-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--header-color);
            text-align: center;
        }
        .review-question {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--incorrect-border);
            background: var(--container-bg);
            border-radius: 4px;
        }
        .review-question-number {
            font-weight: bold;
            color: var(--incorrect-border);
            margin-bottom: 8px;
        }
        .review-question-text {
            margin-bottom: 10px;
        }
        .review-answer {
            margin-top: 8px;
            font-weight: bold;
        }
        .review-correct {
            color: var(--correct-border);
        }
        .review-explanation {
            margin-top: 5px;
            font-style: italic;
            color: var(--secondary-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MCQs on Kinesiology 1 (Hip Joint P1) Quiz</h1>
            <p class="author">Dr. Samy Salem</p>
            <p class="description">Test your knowledge of the hip joint anatomy, biomechanics, and pathologies</p>
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider">
                        <div class="slider-text">
                            <span class="light-text">Light</span>
                            <span class="dark-text">Dark</span>
                        </div>
                    </span>
                </label>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats">
            <div>Question: <span id="current-question">1</span>/<span id="total-questions">40</span></div>
            <div>Score: <span id="score">0</span>/<span id="total-score">40</span></div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <div class="navigation">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>

        <div id="results" class="results">
            <div class="score">Your Score: <span class="score-value" id="final-score">0</span>/40</div>
            <p id="performance-message"></p>
            <button class="restart-btn" id="restart-btn">Restart Quiz</button>
            <button class="review-btn" id="review-btn">Review Incorrect Answers</button>
        </div>

        <div id="review-section" class="review-section">
            <h2 class="review-title">Questions Answered Incorrectly</h2>
            <div id="incorrect-questions-list"></div>
        </div>
    </div>

    <script>
        // Quiz data (40 questions from the PDF)
        const quizData = [
            {
                question: "Which of the following is an osteologic feature found on the external surface of the illum?",
                options: [
                    "Iliac fossa",
                    "Auricular surface",
                    "Iliac tuberosity",
                    "Anterior gluteal line"
                ],
                answer: 3,
                explanation: "D) Anterior gluteal line (Page 6)"
            },
            {
                question: "The lesser sciatic foramen is bounded by which two structures?",
                options: [
                    "Sacrotuberous and sacrospinous ligaments",
                    "Ischial spine and lesser sciatic notch",
                    "Anterior superior and anterior inferior iliac spines",
                    "Iliac crest and posterior gluteal line"
                ],
                answer: 0,
                explanation: "A) Sacrotuberous and sacrospinous ligaments (Page 11)"
            },
            {
                question: "On the femur, what structure is located between the greater and lesser trochanters on the posterior side?",
                options: [
                    "Intertrochanteric line",
                    "Intertrochanteric crest",
                    "Linea aspera",
                    "Gluteal tuberosity"
                ],
                answer: 1,
                explanation: "B) Intertrochanteric crest (Page 14, 15)"
            },
            {
                question: "The depression on the medial aspect of the greater trochanter that serves as an attachment site is the:",
                options: [
                    "Quadrate tubercle",
                    "Trochanteric fossa",
                    "Fovea capitis",
                    "Acetabular notch"
                ],
                answer: 1,
                explanation: "B) Trochanteric fossa (Page 14)"
            },
            {
                question: "The non-articular, fat-filled depression within the acetabulum is called the:",
                options: [
                    "Lunate surface",
                    "Acetabular labrum",
                    "Acetabular fossa",
                    "Acetabular notch"
                ],
                answer: 2,
                explanation: "C) Acetabular fossa (Page 34, 36)"
            },
            {
                question: "What structure attaches to the fovea capitis of the femoral head?",
                options: [
                    "Iliofemoral ligament",
                    "Ligamentum teres",
                    "Zona orbicularis",
                    "Transverse acetabular ligament"
                ],
                answer: 1,
                explanation: "B) Ligamentum teres (Page 34, 56)"
            },
            {
                question: "The fibrocartilaginous ring that deepens the acetabulum is the:",
                options: [
                    "Acetabular labrum",
                    "Transverse acetabular ligament",
                    "Ligamentum teres",
                    "Articular cartilage"
                ],
                answer: 0,
                explanation: "A) Acetabular labrum (Page 36)"
            },
            {
                question: "The angle of inclination of the femur is measured in which anatomical plane?",
                options: [
                    "Sagittal plane",
                    "Frontal (coronal) plane",
                    "Transverse (horizontal) plane",
                    "Oblique plane"
                ],
                answer: 1,
                explanation: "B) Frontal (coronal) plane (Page 18)"
            },
            {
                question: "What is the average angle of inclination in a healthy adult?",
                options: [
                    "40 degrees",
                    "90 degrees",
                    "120 degrees",
                    "150 degrees"
                ],
                answer: 2,
                explanation: "C) 120 degrees (Page 18)"
            },
            {
                question: "A pathologically decreased angle of inclination is termed:",
                options: [
                    "Coxa valga",
                    "Coxa vara",
                    "Excessive anteversion",
                    "Retroversion"
                ],
                answer: 1,
                explanation: "B) Coxa vara (Page 18)"
            },
            {
                question: "Which of the following is a biomechanical consequence of coxa valga?",
                options: [
                    "Increased hip abductor moment arm",
                    "Decreased joint reaction force (JRF)",
                    "Decreased hip abductor moment arm",
                    "Increased joint stability"
                ],
                answer: 2,
                explanation: "C) Decreased hip abductor moment arm (Page 21)"
            },
            {
                question: "Compared to a normal hip, coxa vara is associated with:",
                options: [
                    "Increased shear force across the femoral neck",
                    "Decreased bending moment arm",
                    "Decreased joint stability",
                    "Increased liability for superior dislocation"
                ],
                answer: 0,
                explanation: "A) Increased shear force across the femoral neck (Page 22)"
            },
            {
                question: "The angle of torsion of the femur describes the relationship between the axis of the femoral neck and the axis of the:",
                options: [
                    "Femoral shaft",
                    "Iliac crest",
                    "Femoral condyles",
                    "Acetabulum"
                ],
                answer: 2,
                explanation: "C) Femoral condyles (Page 28)"
            },
            {
                question: "What is the normal range for the angle of femoral anteversion in adults?",
                options: [
                    "0-5 degrees",
                    "10-15 degrees",
                    "30-40 degrees",
                    "40-50 degrees"
                ],
                answer: 1,
                explanation: "B) 10-15 degrees (Page 28)"
            },
            {
                question: "A patient who walks with a 'toe-in' gait is most likely compensating for:",
                options: [
                    "Coxa vara",
                    "Coxa valga",
                    "Excessive femoral anteversion",
                    "Femoral retroversion"
                ],
                answer: 2,
                explanation: "C) Excessive femoral anteversion (Page 30, 31)"
            },
            {
                question: "Which biomechanical change is associated with excessive femoral anteversion?",
                options: [
                    "Decreased joint reaction force (JRF)",
                    "Increased hip abductor moment arm",
                    "Increased demand on hip abductors",
                    "Increased joint stability in anatomical position"
                ],
                answer: 2,
                explanation: "C) Increased demand on hip abductors (Page 31)"
            },
            {
                question: "Femoral retroversion would most likely lead to a compensatory:",
                options: [
                    "Toe-in gait",
                    "Increased lumbar lordosis",
                    "Trendelenburg gait",
                    "Toe-out gait"
                ],
                answer: 3,
                explanation: "D) Toe-out gait (Page 30, 32)"
            },
            {
                question: "The center-edge (CE) angle of Wiberg is measured in which plane and assesses what?",
                options: [
                    "Transverse plane; acetabular depth",
                    "Frontal plane; lateral coverage of the femoral head",
                    "Sagittal plane; anterior coverage of the femoral head",
                    "Frontal plane; femoral neck length"
                ],
                answer: 1,
                explanation: "B) Frontal plane; lateral coverage of the femoral head (Page 43)"
            },
            {
                question: "A diminished center-edge angle in a child is a risk factor for:",
                options: [
                    "Slipped capital femoral epiphysis (SCFE)",
                    "Congenital hip dislocation",
                    "Femoral neck stress fracture",
                    "Acetabular labral tear"
                ],
                answer: 1,
                explanation: "B) Congenital hip dislocation (Page 43)"
            },
            {
                question: "The acetabular anteversion angle, measured in the horizontal plane, primarily functions to:",
                options: [
                    "Prevent superior dislocation of the hip",
                    "Resist hip abduction",
                    "Prevent anterior hip joint dislocation",
                    "Limit hip hyperextension"
                ],
                answer: 2,
                explanation: "C) Prevent anterior hip joint dislocation (Page 45)"
            },
            {
                question: "Which part of the hip joint capsule is described as being the thickest and strongest?",
                options: [
                    "Anterosuperior",
                    "Posteromedial",
                    "Inferior",
                    "Posterolateral"
                ],
                answer: 0,
                explanation: "A) Anterosuperior (Page 47)"
            },
            {
                question: "The iliofemoral ligament is shaped like an inverted 'Y' and attaches from the AIIS (anterior inferior iliac spine) to the:",
                options: [
                    "Intertrochanteric line",
                    "Lesser trochanter",
                    "Ischial tuberosity",
                    "Linea aspera"
                ],
                answer: 0,
                explanation: "A) Intertrochanteric line (Page 50)"
            },
            {
                question: "Which ligament is the primary restraint against hip hyperextension?",
                options: [
                    "Pubofemoral ligament",
                    "Ischiofemoral ligament",
                    "Iliofemoral ligament",
                    "Ligamentum teres"
                ],
                answer: 2,
                explanation: "C) Iliofemoral ligament (Page 50)"
            },
            {
                question: "Which structure primarily becomes taut at the end-range of hip abduction?",
                options: [
                    "Iliofemoral ligament",
                    "Ischiofemoral ligament",
                    "Pubofemoral ligament",
                    "Ligamentum teres"
                ],
                answer: 2,
                explanation: "C) Pubofemoral ligament (Page 49, 52)"
            },
            {
                question: "The ligament that is tense during lateral rotation and relaxed during medial rotation is the:",
                options: [
                    "Iliofemoral ligament",
                    "Pubofemoral ligament",
                    "Ischiofemoral ligament",
                    "Ligamentum teres"
                ],
                answer: 1,
                explanation: "B) Pubofemoral ligament (Page 52)"
            },
            {
                question: "The superior fibers of the ischiofemoral ligament become taut during which combined movement?",
                options: [
                    "Flexion and abduction",
                    "Flexion and lateral rotation",
                    "Extension and abduction",
                    "Extension, adduction, and medial rotation"
                ],
                answer: 3,
                explanation: "D) Extension, adduction, and medial rotation (Page 54)"
            },
            {
                question: "The primary function of the ligamentum teres in adults is thought to be:",
                options: [
                    "A major mechanical stabilizer against dislocation",
                    "Contributing to the vascular supply of the femoral head",
                    "Limiting internal rotation",
                    "Reinforcing the posterior capsule"
                ],
                answer: 1,
                explanation: "B) Contributing to the vascular supply of the femoral head (Page 56)"
            },
            {
                question: "A slipped capital femoral epiphysis (SCFE) is most associated with which bony abnormality?",
                options: [
                    "Coxa vara",
                    "Coxa valga",
                    "Excessive anteversion",
                    "Retroversion"
                ],
                answer: 0,
                explanation: "A) Coxa vara (Page 22)"
            },
            {
                question: "Common symptoms of an acetabular labral tear include all of the following EXCEPT:",
                options: [
                    "Locking or catching sensation",
                    "Pain in the groin",
                    "Increased hip joint range of motion",
                    "Stiffness"
                ],
                answer: 2,
                explanation: "C) Increased hip joint range of motion (Page 38)"
            },
            {
                question: "Femoroacetabular impingement (FAI) caused by an abnormal bony bump on the femoral head-neck junction is classified as:",
                options: [
                    "Pincer type",
                    "CAM type",
                    "Mixed type",
                    "Labral type"
                ],
                answer: 1,
                explanation: "B) CAM type (Page 40)"
            },
            {
                question: "What becomes taut at the end-range of hip flexion with the knee flexed?",
                options: [
                    "Hamstrings",
                    "Rectus femoris",
                    "Inferior and posterior capsule; gluteus maximus",
                    "Iliofemoral ligament"
                ],
                answer: 2,
                explanation: "C) Inferior and posterior capsule; gluteus maximus (Page 49)"
            },
            {
                question: "At the end-range of hip extension with the knee extended, which structure is primarily taut?",
                options: [
                    "Rectus femoris",
                    "Hamstrings",
                    "Iliofemoral ligament",
                    "Ischiofemoral ligament"
                ],
                answer: 2,
                explanation: "C) Iliofemoral ligament (Page 49)"
            },
            {
                question: "The close-packed position of the hip joint, where ligaments are maximally taut, is:",
                options: [
                    "Flexion, abduction, and external rotation",
                    "Flexion, abduction, and internal rotation",
                    "Extension, abduction, and internal rotation",
                    "Extension, abduction, and external rotation"
                ],
                answer: 2,
                explanation: "C) Extension, abduction, and internal rotation (Page 59)"
            },
            {
                question: "The mechanical axis of the lower limb runs from the center of the femoral head to the:",
                options: [
                    "Midpoint between the femoral condyles",
                    "Center of the knee joint",
                    "Tibial tuberosity",
                    "Center of the ankle mortise"
                ],
                answer: 0,
                explanation: "A) Midpoint between the femoral condyles (Page 18)"
            },
            {
                question: "The normal angle between the anatomical axis of the femur and its mechanical axis is approximately:",
                options: [
                    "0-2 degrees",
                    "5-7 degrees",
                    "10-12 degrees",
                    "15-20 degrees"
                ],
                answer: 1,
                explanation: "B) 5-7 degrees (Page 18)"
            },
            {
                question: "The primary function of a normal angle of inclination is to:",
                options: [
                    "Increase the lever arm for the hip abductors",
                    "Prevent anterior dislocation of the hip",
                    "Align the knee joint in the transverse plane",
                    "Move the longitudinal axis of the femur away from the hip joint, allowing greater freedom of movement"
                ],
                answer: 3,
                explanation: "D) Move the longitudinal axis of the femur away from the hip joint, allowing greater freedom of movement (Page 18)"
            },
            {
                question: "The zona orbicularis refers to:",
                options: [
                    "The circular fibers of the hip joint capsule",
                    "The rim of the acetabular labrum",
                    "A ligament within the acetabular fossa",
                    "The synovial fold around the ligamentum teres"
                ],
                answer: 0,
                explanation: "A) The circular fibers of the hip joint capsule (Page 47, 55)"
            },
            {
                question: "Which muscle has a proximal attachment on the anterior inferior iliac spine (AIIS)?",
                options: [
                    "Sartorius",
                    "Rectus femoris",
                    "Tensor fasciae latae",
                    "Pectineus"
                ],
                answer: 1,
                explanation: "B) Rectus femoris (Page 7, 12)"
            },
            {
                question: "The muscle that attaches to the adductor tubercle on the femur is the:",
                options: [
                    "Adductor longus",
                    "Adductor brevis",
                    "Adductor magnus",
                    "Gracilis"
                ],
                answer: 2,
                explanation: "C) Adductor magnus (Page 16)"
            },
            {
                question: "Which ligament, when taut from hip extension, is correctly paired in the closed-packed position of the hip joint?",
                options: [
                    "Pubofemoral ligament - taut from extension and abduction",
                    "Ischiofemoral ligament - taut from extension only",
                    "Iliofemoral ligament - taut from flexion",
                    "Ligamentum teres - taut from external rotation"
                ],
                answer: 0,
                explanation: "A) Pubofemoral ligament - taut from extension and abduction (Page 59)"
            }
        ];

        // Quiz state variables
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let incorrectQuestions = [];

        // DOM elements
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const resultsContainer = document.getElementById('results');
        const finalScoreEl = document.getElementById('final-score');
        const performanceMessageEl = document.getElementById('performance-message');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const reviewSection = document.getElementById('review-section');
        const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const lightText = document.querySelector('.light-text');
        const darkText = document.querySelector('.dark-text');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            showQuestion();
            updateProgressBar();
            
            // Initialize dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
                updateToggleText(true);
            } else {
                updateToggleText(false);
            }
            
            // Event listeners
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            reviewBtn.addEventListener('click', showIncorrectQuestions);
            darkModeToggle.addEventListener('change', toggleDarkMode);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateToggleText(isDarkMode);
        }

        // Update toggle text opacity
        function updateToggleText(isDarkMode) {
            if (isDarkMode) {
                lightText.style.opacity = '0.5';
                darkText.style.opacity = '1';
            } else {
                lightText.style.opacity = '1';
                darkText.style.opacity = '0.5';
            }
        }

        // Show current question
        function showQuestion() {
            currentQuestionEl.textContent = currentQuestion + 1;
            scoreEl.textContent = score;
            
            const question = quizData[currentQuestion];
            let optionsHTML = '';
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[currentQuestion] === index) {
                    optionClass += ' selected';
                    if (index === question.answer) {
                        optionClass += ' correct';
                    } else {
                        optionClass += ' incorrect';
                    }
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `;
            });
            
            let feedbackHTML = '';
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === question.answer;
                feedbackHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '✓ Correct!' : '✗ Incorrect!'} 
                        ${!isCorrect ? `Correct answer: ${String.fromCharCode(65 + question.answer)}) ${question.options[question.answer]}` : ''}
                        <br><br>Explanation: ${question.explanation}
                    </div>
                `;
            }
            
            quizContainer.innerHTML = `
                <div class="question">
                    <div class="question-number">Question ${currentQuestion + 1}/${quizData.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">${optionsHTML}</div>
                    ${feedbackHTML}
                </div>
            `;
            
            // Add event listeners to options
            const optionElements = quizContainer.querySelectorAll('.option');
            optionElements.forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Update navigation buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finish Quiz' : 'Next';
        }

        // Select an option
        function selectOption(e) {
            if (userAnswers[currentQuestion] !== null) return; // Already answered
            
            const selectedOption = e.currentTarget;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            userAnswers[currentQuestion] = selectedIndex;
            
            // Check if answer is correct
            if (selectedIndex === quizData[currentQuestion].answer) {
                score++;
                scoreEl.textContent = score;
            } else {
                // Add to incorrect questions list
                incorrectQuestions.push({
                    question: quizData[currentQuestion].question,
                    userAnswer: selectedIndex,
                    correctAnswer: quizData[currentQuestion].answer,
                    options: quizData[currentQuestion].options,
                    explanation: quizData[currentQuestion].explanation,
                    questionNumber: currentQuestion + 1
                });
            }
            
            showQuestion();
            updateProgressBar();
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show results
        function showResults() {
            quizContainer.style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            finalScoreEl.textContent = score;
            
            // Performance message
            const percentage = (score / quizData.length) * 100;
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Hip Joint anatomy and biomechanics.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid grasp of the material.';
            } else if (percentage >= 40) {
                message = 'Not bad! Review the material and try again.';
            } else {
                message = 'Keep studying! Review the lectures and try again.';
            }
            
            performanceMessageEl.textContent = message;
            resultsContainer.style.display = 'block';
            
            // Show review button only if there are incorrect answers
            if (incorrectQuestions.length > 0) {
                reviewBtn.style.display = 'inline-block';
            } else {
                reviewBtn.style.display = 'none';
            }
        }

        // Show incorrect questions
        function showIncorrectQuestions() {
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'block';
            
            let incorrectHTML = '';
            incorrectQuestions.forEach((item, index) => {
                incorrectHTML += `
                    <div class="review-question">
                        <div class="review-question-number">Question ${item.questionNumber}</div>
                        <div class="review-question-text">${item.question}</div>
                        <div>Your answer: ${String.fromCharCode(65 + item.userAnswer)}) ${item.options[item.userAnswer]}</div>
                        <div class="review-answer review-correct">Correct answer: ${String.fromCharCode(65 + item.correctAnswer)}) ${item.options[item.correctAnswer]}</div>
                        <div class="review-explanation">${item.explanation}</div>
                    </div>
                `;
            });
            
            incorrectQuestionsList.innerHTML = incorrectHTML;
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            incorrectQuestions = [];
            
            quizContainer.style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.progress-container').style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'none';
            
            showQuestion();
            updateProgressBar();
        }

        // Initialize the quiz when the page loads
        window.onload = initQuiz;
    </script>
</body>
</html>